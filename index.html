<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth & Condivisione Schermo</title>
</head>
<body>
    <h1>Connessione Bluetooth e Condivisione Schermo</h1>

    <!-- Messaggio per dispositivi non compatibili con Bluetooth -->
    <div id="noBluetoothSupport" style="display:none;">
        <p>La scansione Bluetooth non è supportata su questo browser.</p>
    </div>

    <!-- Sezione Bluetooth (solo per browser compatibili) -->
    <button id="scan" style="display:none;">Scansiona dispositivi Bluetooth</button>
    <ul id="deviceList"></ul>

    <!-- Sezione per la condivisione dello schermo -->
    <button id="shareScreen">Condividi lo schermo</button>
    <div id="screenContainer"></div>

    <script>
        // Verifica se Web Bluetooth è supportato nel browser
        if ('bluetooth' in navigator) {
            document.getElementById('scan').style.display = 'block'; // Mostra il pulsante solo se Bluetooth è supportato

            const scanButton = document.getElementById('scan');
            const deviceList = document.getElementById('deviceList');

            scanButton.addEventListener('click', async () => {
                try {
                    const device = await navigator.bluetooth.requestDevice({
                        acceptAllDevices: true,
                        optionalServices: ['battery_service']
                    });

                    const listItem = document.createElement('li');
                    listItem.textContent = `Dispositivo trovato: ${device.name} (ID: ${device.id})`;
                    deviceList.appendChild(listItem);

                    const code = prompt('Inserisci il codice di connessione per questo dispositivo:');
                    if (code === '1234') {
                        alert('Codice corretto! Connesso al dispositivo.');
                    } else {
                        alert('Codice errato. Riprova.');
                    }

                } catch (error) {
                    console.error('Errore durante la scansione Bluetooth:', error);
                    alert('Errore durante la scansione Bluetooth. Usa un browser compatibile.');
                }
            });
        } else {
            // Se Bluetooth non è supportato, mostra un messaggio
            document.getElementById('noBluetoothSupport').style.display = 'block';
        }

        // Funzione per la condivisione dello schermo (funziona su tutti i browser principali, inclusi Safari)
        const shareScreenButton = document.getElementById('shareScreen');
        const screenContainer = document.getElementById('screenContainer');

        shareScreenButton.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                const videoElement = document.createElement('video');
                videoElement.srcObject = stream;
                videoElement.play();
                screenContainer.appendChild(videoElement);
            } catch (error) {
                console.error('Errore durante la condivisione dello schermo:', error);
                alert('Errore durante la condivisione dello schermo.');
            }
        });
    </script>
</body>
</html>
