<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juniper Green Multiplayer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1d1f27;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        h1 {
            font-size: 3rem;
            color: #ffdd57;
            margin-bottom: 20px;
        }
        .btn {
            padding: 15px 30px;
            background-color: #ffdd57;
            color: #1d1f27;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s ease;
            border-radius: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
        }
        .btn:hover {
            background-color: #ffaa00;
        }
        .input-container {
            margin-bottom: 20px;
        }
        #gameGrid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 10px;
        }
        .grid-cell {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #333;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 8px;
        }
        .grid-cell.selected {
            background-color: #ffaa00;
            cursor: not-allowed;
        }
        footer {
            position: absolute;
            bottom: 10px;
            text-align: center;
            width: 100%;
            color: #ffdd57;
        }
        .flag-icon {
            width: 24px;
            margin-right: 5px;
        }
        .language-selector {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .language-selector select {
            margin-left: 10px;
            padding: 5px;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <h1 id="title">Juniper Green Multiplayer</h1>

    <!-- Version Number -->
    <div id="version" style="position: absolute; top: 10px; right: 10px; color: #ffdd57;">
        Versione: 1.0.1
    </div>

    <!-- Main Menu -->
    <div id="mainPage" style="display: none;">
        <button class="btn" id="createGameBtn" onclick="chooseGameMode()">Crea una Partita</button>
        <button class="btn" id="joinGameBtn" onclick="joinGameSelector()">Entra in una Partita</button>
        <button class="btn" id="challengeComputerBtn" onclick="chooseComputerLevel()">Sfida il Computer</button>
        <button class="btn" id="settingsBtn" onclick="viewSettings()">Impostazioni</button>
        <button class="btn" id="changelogBtn" onclick="viewChangelog()">Changelogs</button>
    </div>

    <!-- Settings with Flags and Color Picker -->
    <div id="settingsPage" style="display: none;">
        <h2>Impostazioni</h2>
        <div class="language-selector">
            <label for="languageSelector">Seleziona Lingua:</label>
            <select id="languageSelector">
                <option value="it"><img class="flag-icon" src="https://flagcdn.com/it.svg" alt="Italian">Italiano</option>
                <option value="en"><img class="flag-icon" src="https://flagcdn.com/us.svg" alt="English">Inglese</option>
                <option value="fr"><img class="flag-icon" src="https://flagcdn.com/fr.svg" alt="French">Francese</option>
                <option value="es"><img class="flag-icon" src="https://flagcdn.com/es.svg" alt="Spanish">Spagnolo</option>
                <option value="de"><img class="flag-icon" src="https://flagcdn.com/de.svg" alt="German">Tedesco</option>
            </select>
        </div>
        <br/>
        <label for="playerColor">Colore del giocatore:</label>
        <input type="color" id="playerColor" value="#ffaa00" />
        <br/>
        <label for="opponentColor">Colore avversario:</label>
        <input type="color" id="opponentColor" value="#ff0000" />
        <br/>
        <button class="btn" onclick="saveSettings()">Salva</button>
        <button class="btn" onclick="backToMain()">Indietro</button>
    </div>

    <!-- Game Grid and Other Features As Previously -->
    <div id="gridSelectionPage" style="display: none;">
        <h2>Scegli la dimensione della griglia</h2>
        <button class="btn" onclick="startGame(10)">Griglia 10</button>
        <button class="btn" onclick="startGame(20)">Griglia 20</button>
        <button class="btn" onclick="startGame(30)">Griglia 30</button>
        <button class="btn" onclick="startGame(40)">Griglia 40</button>
        <button class="btn" onclick="startGame(50)">Griglia 50</button>
        <button class="btn" onclick="startGame(60)">Griglia 60</button>
        <button class="btn" onclick="startGame(70)">Griglia 70</button>
        <button class="btn" onclick="startGame(80)">Griglia 80</button>
        <button class="btn" onclick="startGame(90)">Griglia 90</button>
        <button class="btn" onclick="startGame(100)">Griglia 100</button>
    </div>

    <div id="gamePage" style="display: none;">
        <h2 id="gameMessage">Inizia la partita!</h2>
        <div id="gameGrid"></div>
        <button class="btn" onclick="quitGame()">Esci</button>
    </div>

    <footer>Made with ❤️ by Arciale</footer>

    <script>
        let registeredUsers = JSON.parse(localStorage.getItem('users')) || [];
        let currentUser = null;
        let currentGridSize = 10;

        function saveSettings() {
            const playerColor = document.getElementById('playerColor').value;
            const opponentColor = document.getElementById('opponentColor').value;
            const language = document.getElementById('languageSelector').value;

            localStorage.setItem('playerColor', playerColor);
            localStorage.setItem('opponentColor', opponentColor);
            localStorage.setItem('language', language);

            changeLanguage(language);
            backToMain();
        }

        function changeLanguage(language) {
            const translations = {
                en: {
                    createGameBtn: "Create a Game",
                    joinGameBtn: "Join a Game",
                    challengeComputerBtn: "Challenge the Computer",
                    settingsBtn: "Settings",
                    changelogBtn: "Changelogs",
                    playerColor: "Player Color",
                    opponentColor: "Opponent Color"
                },
                it: {
                    createGameBtn: "Crea una Partita",
                    joinGameBtn: "Entra in una Partita",
                    challengeComputerBtn: "Sfida il Computer",
                    settingsBtn: "Impostazioni",
                    changelogBtn: "Changelogs",
                    playerColor: "Colore del giocatore",
                    opponentColor: "Colore avversario"
                },
                fr: {
                    createGameBtn: "Créer une Partie",
                    joinGameBtn: "Rejoindre une Partie",
                    challengeComputerBtn: "Défier l'Ordinateur",
                    settingsBtn: "Paramètres",
                    changelogBtn: "Changelogs",
                    playerColor: "Couleur du Joueur",
                    opponentColor: "Couleur de l'Adversaire"
                },
                es: {
                    createGameBtn: "Crear una Partida",
                    joinGameBtn: "Unirse a una Partida",
                    challengeComputerBtn: "Desafiar al Computador",
                    settingsBtn: "Ajustes",
                    changelogBtn: "Changelogs",
                    playerColor: "Color del Jugador",
                    opponentColor: "Color del Oponente"
                },
                de: {
                    createGameBtn: "Erstellen Sie ein Spiel",
                    joinGameBtn: "Spiel Beitreten",
                    challengeComputerBtn: "Computer Herausfordern",
                    settingsBtn: "Einstellungen",
                    changelogBtn: "Changelogs",
                    playerColor: "Spielerfarbe",
                    opponentColor: "Gegnerfarbe"
                }
            };

                   document.getElementById("createGameBtn").textContent = translations[language].createGameBtn;
            document.getElementById("joinGameBtn").textContent = translations[language].joinGameBtn;
            document.getElementById("challengeComputerBtn").textContent = translations[language].challengeComputerBtn;
            document.getElementById("settingsBtn").textContent = translations[language].settingsBtn;
            document.getElementById("changelogBtn").textContent = translations[language].changelogBtn;
            document.getElementById("playerColor").labels[0].textContent = translations[language].playerColor;
            document.getElementById("opponentColor").labels[0].textContent = translations[language].opponentColor;
        }

        window.onload = function () {
            const storedLanguage = localStorage.getItem('language');
            if (storedLanguage) {
                document.getElementById('languageSelector').value = storedLanguage;
                changeLanguage(storedLanguage);
            }
        };

        function startGame(gridSize) {
            currentGridSize = gridSize;
            document.getElementById('gridSelectionPage').style.display = 'none';
            document.getElementById('gamePage').style.display = 'block';
            setupGrid(gridSize);
        }

        function setupGrid(gridSize) {
            const gridContainer = document.getElementById('gameGrid');
            gridContainer.innerHTML = ''; // Clear previous grid

            for (let i = 1; i <= gridSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.textContent = i;
                cell.onclick = () => selectNumber(i, cell);
                gridContainer.appendChild(cell);
            }
        }

        let currentPlayer = 1;
        let lastSelectedNumber = null;

        function selectNumber(number, cell) {
            if (cell.classList.contains('selected')) return;

            if (lastSelectedNumber !== null && !isValidMove(lastSelectedNumber, number)) {
                alert('Mossa non valida! Scegli un multiplo o un divisore del numero precedente.');
                return;
            }

            cell.classList.add('selected');
            lastSelectedNumber = number;

            if (checkGameOver()) {
                alert(`Gioco terminato! Il vincitore è il Giocatore ${currentPlayer}`);
                return;
            }

            currentPlayer = currentPlayer === 1 ? 2 : 1;
            updateGameMessage();
        }

        function isValidMove(lastNumber, newNumber) {
            return newNumber % lastNumber === 0 || lastNumber % newNumber === 0;
        }

        function checkGameOver() {
            const cells = document.querySelectorAll('.grid-cell:not(.selected)');
            return Array.from(cells).every(cell => !isValidMove(lastSelectedNumber, parseInt(cell.textContent)));
        }

        function updateGameMessage() {
            document.getElementById('gameMessage').textContent = `È il turno del Giocatore ${currentPlayer}`;
        }

        function quitGame() {
            location.reload();
        }
    </script>
</body>
</html>
